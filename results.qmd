# Results

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r}
library(dplyr)
library(ggplot2)
library(forcats)
library(tidyr)
library(lubridate)
library(stringr)

data <- read.csv("data/Crash_Reporting_-_Drivers_Data.csv", header = TRUE, sep=",",na.strings=c("","N/A"))
data_q1 = data |> select(Route.Type,Cross.Street.Type)
data_q2 = data |> select(Crash.Date.Time)
data_q3 = data |> select(Driver.Substance.Abuse,Driver.Distracted.By,
                         Vehicle.Movement,Equipment.Problems,
                         Injury.Severity,Vehicle.Damage.Extent)
data_q4 = data |> select(Weather,Surface.Condition,Light,
                         Traffic.Control,Speed.Limit,
                         Injury.Severity,Vehicle.Damage.Extent)
data_q5 = data |> select(Vehicle.Body.Type,Vehicle.Year,
                         Vehicle.Make,Vehicle.Damage.Extent)
```

## Q1

```{r}
# Change Variables as factors
data_q1$Route.Type =  as.factor(data_q1$Route.Type) |> 
  fct_explicit_na("NA")
data_q1$Cross.Street.Type = as.factor(data_q1$Cross.Street.Type) |> 
  fct_explicit_na("NA")

ggplot(data_q1, aes(y = fct_relevel(fct_rev(fct_infreq(Route.Type)), 
                                    "NA"))) +
  geom_bar(fill = "cornflowerblue") +
  labs(x = "Number of Crashes", 
       y = "Route Type", 
       title = "Number of Crashes by Route Types") +
  theme_light()

ggplot(data_q1, aes(y = fct_relevel(fct_rev(fct_infreq(Cross.Street.Type)), 
                                    "NA"))) +
  geom_bar(fill = "cornflowerblue") +
  labs(x = "Number of Crashes",
       y = "Cross Street Type",
       title = "Number of Crashes by Cross Street Types") +
  theme_light()
```

```{r}
data_q1$id = rownames(data_q1)
data_q1 = pivot_longer(data_q1,cols=Route.Type:Cross.Street.Type)
ggplot(data_q1,aes(y = fct_relevel(fct_rev(fct_infreq(value)), 
                                    "NA"), fill = name)) +
  geom_bar(position = "dodge") +
  labs(x = "Number of Crashes",
       y = "Types",
       title = "Number of Crashes by Route Types and Cross Street Types") +
  theme_light()
```

## Q2

```{r}
data_q2$Crash.Date.Time = mdy_hms(data_q2$Crash.Date.Time)
data_q2$Year = as.factor(year(data_q2$Crash.Date.Time))
data_q2$Month = as.factor(months(data_q2$Crash.Date.Time)) |> 
  fct_relevel("January","February","March","April","May","June","July",
              "August","September","October","November","December")
data_q2$Day = as.factor(day(data_q2$Crash.Date.Time))
data_q2$Weekday = as.factor(weekdays(data_q2$Crash.Date.Time)) |> 
  fct_relevel("Sunday","Monday","Tuesday","Wednesday","Thursday",
              "Friday","Saturday")
data_q2$Hours = as.factor(hour(data_q2$Crash.Date.Time))

ggplot(data_q2,aes(x = Year)) +
  geom_point(stat = "count") +
  geom_line(aes(group = 1), stat = "count", color = "cornflowerblue") +
  ggtitle("Number of Crashes by Year") +
  theme_light()

ggplot(data_q2,aes(x = Month)) +
  geom_point(stat = "count") +
  geom_line(aes(group = 1), stat = "count", color = "cornflowerblue") +
  ggtitle("Number of Crashes by Month") +
  theme_light()

ggplot(data_q2,aes(x = Day)) +
  geom_point(stat = "count") +
  geom_line(aes(group = 1), stat = "count", color = "cornflowerblue") +
  ggtitle("Number of Crashes by Day") +
  theme_light()

ggplot(data_q2,aes(x = Weekday)) +
  geom_point(stat = "count") +
  geom_line(aes(group = 1), stat = "count", color = "cornflowerblue") +
  ggtitle("Number of Crashes by Weekday") +
  theme_light()

ggplot(data_q2,aes(x = Hours)) +
  geom_point(stat = "count") +
  geom_line(aes(group = 1), stat = "count", color = "cornflowerblue") +
  ggtitle("Number of Crashes by Hours") +
  theme_light()

```

```{r, fig.width=12, fig.height=8}
ggplot(data_q2,aes(Month)) +
  geom_point(stat = "count") +
  geom_density(aes(group = 1), stat = "count", color = "cornflowerblue") +
  facet_wrap(~Year,ncol = 9) +
  labs(y = "Number of Crashes", 
       title = "Number of Crashes Facet by Year") +
  theme_light() +
  theme(axis.text.x = element_text(size = 6, angle = 45)) +
  scale_x_discrete(labels = function(x) str_sub(x, 1, 3))
```

## Q3

```{r}
summary(data_q3)
```

```{r}
data_q3$Driver.Substance.Abuse = as.factor(data_q3$Driver.Substance.Abuse) |> 
  fct_explicit_na("NA")
data_q3$Driver.Distracted.By = as.factor(data_q3$Driver.Distracted.By) |> 
  fct_explicit_na("NA")
data_q3$Vehicle.Movement = as.factor(data_q3$Vehicle.Movement) |> 
  fct_explicit_na("NA")
data_q3$Equipment.Problems = as.factor(data_q3$Equipment.Problems) |> 
  fct_explicit_na("NA")
```

